# Agent Development Rules

## Code Quality Standards

### Clean Code Principles
- Write self-documenting code with clear, descriptive variable and function names
- Keep functions small and focused on a single responsibility
- Use consistent indentation and formatting
- Remove commented-out code and unnecessary comments
- Follow DRY (Don't Repeat Yourself) principle

### API Integration Standards
- Use centralized API service from api.js for all backend communications
- Implement proper error handling for all API calls
- Use consistent request/response patterns across the application
- Implement loading states and user feedback for async operations
- Cache API responses where appropriate to improve performance
- Use proper HTTP methods (GET, POST, PUT, DELETE) for respective operations
- Implement request interceptors for authentication tokens
- Handle network failures gracefully with retry mechanisms
- Validate API responses before processing
- Use environment variables for API endpoints and configuration

### Best Practices
- Follow language-specific style guides and conventions
- Use meaningful commit messages
- Implement proper error handling
- Optimize for readability over cleverness
- Use appropriate design patterns when beneficial

## Code Review Process

### Structure Review
- Verify proper file organization and folder structure
- Check for appropriate separation of concerns
- Ensure consistent naming conventions across the project
- Validate proper dependency management

### Logic Review
- Verify algorithmic correctness and efficiency
- Check for edge cases and error conditions
- Ensure proper data validation
- Review security implications
- Validate performance considerations

## Testing Policy

### Test File Management
- **DO NOT** create permanent test files in the project
- If temporary test files are created during development:
    - Use them only for immediate verification
    - Delete immediately after testing
    - Never commit test files to version control
- Focus on writing testable code rather than separate test files

### Testing Approach
- Write code that can be easily verified through manual testing
- Use console logging for debugging during development
- Remove all debug code before finalizing
- Ensure code works in the target environment

قبل اى تعديل 
راجع الحقول السابقه جيدا و تاكد انك لا تحتاج لاضافه حقول جديده الا للضروره
تاكد من الدوال السابقه جيدا و تاكد انك تحتاج لاضافه دوال جديده و ان الدوال الجديده لا يوجد مثلها او من يقوم بنفس الوظيفه من قبل

# وثيقة متطلبات البرمجيات (SRS)

## 🧩 أولاً: المتطلبات الوظيفية (Functional Requirements)

## 1. تسجيل الدخول والتسجيل
### FR1 - تسجيل حساب جديد
- يجب أن يتمكن المستخدم من الضغط على زر "تسجيل حساب جديد".
- يجب أن يتم عرض نموذج تسجيل يحتوي على: الاسم، البريد الإلكتروني، كلمة المرور، نوع الحساب (بائع / مشتري).
- يجب أن يوافق المستخدم على الشروط والأحكام قبل التسجيل.
- بعد التسجيل، يتم إرسال كود مكون من 6 أرقام إلى البريد الإلكتروني المُدخل.
- يجب على المستخدم إدخال الكود لتوثيق الحساب قبل استخدامه.

### FR2 - تحديد نوع الحساب (بائع / مشتري)
- يجب أن يتم تخيير المستخدم بين "بائع" أو "مشتري" عند التسجيل.
- يتم توجيه المستخدم إلى لوحة التحكم المناسبة بناءً على اختياره.
- يمكنه لاحقًا تغيير نوع الحساب من لوحة التحكم (تفعيل وضع البائع أو العودة لوضع المشتري).

### FR3 - تسجيل الدخول
- يجب أن يتمكن المستخدم من تسجيل الدخول باستخدام البريد الإلكتروني وكلمة المرور.
- يتم التحقق من البيانات قبل تسجيل الدخول.

### FR4 - تعديل البيانات الشخصية
- يمكن للمستخدم الدخول إلى صفحة الإعدادات.
- يمكنه تغيير الاسم، كلمة المرور، صورة الملف الشخصي، نوع الحساب.

### FR5 - استرجاع كلمة المرور
- عند الضغط على "نسيت كلمة المرور"، يتم طلب البريد الإلكتروني فقط في الخطوة الأولى.
- يتم إرسال كود مكون من 6 أرقام إلى البريد المُدخل مع رابط مباشر للاسترجاع.
- يجب أن تكون صلاحية الكود محدودة (15 دقيقة) ولا يمكن استخدامه أكثر من مرة.
- بعد إدخال الكود الصحيح، يتم توجيه المستخدم إلى صفحة إعادة تعيين كلمة المرور.
- يجب أن يحدد المستخدم كلمة مرور جديدة قوية (8 أحرف على الأقل، أرقام، أحرف خاصة).
- بعد تغيير كلمة المرور بنجاح، يجب إلغاء جميع الجلسات النشطة وإجبار المستخدم على تسجيل الدخول من جديد.
- إرسال إشعار بالبريد الإلكتروني لتأكيد تغيير كلمة المرور بنجاح مع وقت وتاريخ العملية.

## 🔐 ثانيًا: متطلبات الأمان (Security Requirements)

### SR1 - التحقق بخطوتين للتسجيل
- يجب استخدام البريد الإلكتروني للتحقق من هوية المستخدم قبل تفعيل الحساب.
- يجب أن يكون رمز التحقق عشوائي بالكامل ومكون من 6 أرقام على الأقل.
- إذا لم يتم التحقق خلال 24 ساعة، يجب تعطيل الحساب مؤقتًا وطلب إعادة التحقق.
- يجب ألا يتمكن المستخدم من الوصول إلى أي ميزات مقيدة قبل إتمام عملية التحقق.

### SR2 - تشفير كلمات المرور
- يجب تخزين كلمات المرور باستخدام خوارزميات تشفير آمنة (مثل bcrypt أو Argon2).
- لا يتم تخزين كلمة المرور بنص صريح أبدًا.

### SR3 - حماية من هجمات القوة الغاشمة (Brute Force)
- تحديد عدد محاولات تسجيل الدخول الفاشلة (مثلاً 5 محاولات).
- بعد ذلك يتم تعطيل تسجيل الدخول مؤقتًا أو طلب تحقق إضافي.

### SR4 - التحقق من صحة البريد الإلكتروني
- يجب التحقق من صحة تنسيق البريد الإلكتروني وأنه غير مستخدم من قبل.

### SR5 - الحد من إعادة إرسال كود التفعيل
- يمكن إرسال الكود مرة واحدة فقط كل دقيقة لتجنب الإسراف أو محاولة التخمين.

### SR6 - رابط إعادة تعيين كلمة المرور مؤقت
- رابط/كود استرجاع كلمة المرور يجب أن يكون فعالًا لمدة قصيرة (مثل 15 دقيقة).
- يتم إلغاؤه تلقائيًا بعد استخدامه مرة واحدة.

### SR17 - التحقق من عدد الدعوات الفعلية
- لا يتم احتساب دخول أي جهاز يملك نفس الـ IP.
- يتم منع التحايل من خلال:
  - تسجيل الدخول من نفس الجهاز أو نفس المتصفح لا يُحسب كدعوة جديدة.
  - احتساب دعوة واحدة فقط من كل جهاز.

### SR18 - تحديد فترة السماح للباقة المجانية
- لا يمكن الحصول على أكثر من 3 باقات مجانية خلال أول 3 شهور.
- لا يمكن استخدام روابط دعوة قديمة بعد تجاوز الحد.

### SR19 - قفل صلاحيات عند انتهاء الباقة
بمجرد انتهاء الصلاحية:
- يتم منع الوصول للوحة التحكم.
- تُصبح المنتجات في حالة "مجمدة".
- تُمنع إمكانية تعديل، حذف أو إضافة أي محتوى.

### SR20 - التحقق من صلاحية الباقة عند رفع منتج
- أي محاولة لإضافة منتج بدون باقة نشطة تُرفض.
- يتم التحقق في كل مرة من حالة الباقة قبل إظهار زر "أضف منتج".

## 🛡️ ثالثًا: سيناريوهات الحماية (Security Use Cases)

### ✅ UC1 - تأمين تسجيل الحساب
**موقف:** يحاول المستخدم إنشاء حساب وهمي أو برمجي
**الحماية:**
- التحقق من البريد الإلكتروني.
- التحقق من أن البريد غير مسجل مسبقًا.

### ✅ UC2 - منع الدخول غير المشروع
**موقف:** يحاول مستخدم تخمين بيانات الدخول لحساب آخر
**الحماية:**
- عدد محاولات محدود لتسجيل الدخول.
- إشعار بالبريد الإلكتروني في حالة محاولة دخول فاشلة كثيرة.

### ✅ UC3 - استرجاع كلمة المرور بطريقة آمنة
**موقف:** شخص يحاول سرقة حساب عن طريق استرجاع كلمة مرور ليس حسابه
**الحماية:**
- إرسال كود الاسترجاع للبريد المرتبط فقط.
- التحقق من الكود.
- عدم عرض أي معلومة عن الحساب إن لم يكن البريد موجودًا أصلًا.

### ✅ UC4 - تأمين نظام الباقات والدعوات

#### UC13 - محاولة تجاوز شروط الباقة المجانية بالدعوات الوهمية
**الموقف:** مستخدم يحاول فتح حسابات وهمية ودعوتها بالرابط
**الحماية:**
- يتم احتساب IP فريد فقط.
- نفس الجهاز لا يمكنه إنشاء أكثر من دعوة.
- وجود Rate Limiting في التسجيل من IP واحد.

#### UC14 - تجاوز حد الباقات المجانية
**الموقف:** مستخدم يحاول استغلال النظام وتفعيل أكثر من 3 باقات مجانية
**الحماية:**
- النظام يسجل عدد المرات التي تم فيها تفعيل الباقة المجانية.
- يتم حظر الخيار بعد تجاوز 3 مرات خلال أول 90 يومًا.

#### UC15 - رفع منتج بعد انتهاء الباقة
**الموقف:** بائع يحاول فتح رابط رفع المنتج مباشرة بعد انتهاء الباقة
**الحماية:**
- يتم التحقق من حالة الباقة في كل عملية.
- تظهر رسالة: "انتهت صلاحية باقتك، يرجى التجديد أولًا".

#### UC16 - محاولات تعديل الملف الشخصي بعد انتهاء الباقة
**الموقف:** بائع يحاول تعديل معلوماته أو إعادة تفعيل منتجاته يدويًا
**الحماية:**
- يتم قفل لوحة التحكم بالكامل مع ظهور إشعار بالتجميد.
- واجهة المستخدم تمنع الوصول لأي روابط تعديل.

---

## 2. إدارة المنتجات

**وصف الخاصية:**
تمكن البائع من إضافة وتعديل وحذف المنتجات مع تفاصيل (اسم، وصف، صور، سعر، تصنيف).

**خطوات الاستخدام:**
1. يدخل البائع إلى لوحة التحكم ويختار "إضافة منتج".
2. يملأ بيانات المنتج ويرفع الصور.
3. يمكنه تعديل أو حذف المنتجات لاحقًا.

**متطلبات النظام:**
- رفع الصور وتخزينها بشكل آمن.
- ربط كل منتج ببائع وتصنيف.
- دعم البحث والتصفية للمنتجات.

**سيناريوهات الحماية:**
- منع إضافة منتجات بدون بيانات أساسية.
- مراجعة المنتجات قبل النشر (في حال التفعيل).
- منع حذف منتج عليه طلبات نشطة.

### FR6 - التحقق من الاشتراك قبل رفع المنتج
- لا يستطيع البائع رفع منتجات جديدة إلا إذا كان مشتركًا في الباقات المدفوعة (100 أو 250 جنيه شهريًا).
- في حال عدم الاشتراك أو انتهاءه، تظهر لوحة التحكم الخاصة به مقفولة (مع عرض رسالة تنبيهية).
- يتم توجيهه إلى صفحة الاشتراك عند محاولة استخدام الميزات المحجوبة.

### FR7 - رفع منتج جديد
- يجب أن يتمكن البائع المشترك من الضغط على زر "إضافة منتج".
- تظهر له نافذة منبثقة (Pop-up) أو صفحة خاصة تطلب منه إدخال:
    - عنوان المنتج
    - وصف مفصل
    - التصنيف 
    - السعر
    - الكلمات المفتاحيه
    - مدة التسليم المتوقعة
    - الكمية المتاحة (اختياري)
    - وقت التحضير (إذا كان المنتج حرفة)
    - نوع المنتج (منتج قابل للبيع / حرفة )
    - تحميل صور (حتى 5 صور)

### FR8 - مراجعة المنتج قبل النشر
- بعد إرسال المنتج، يتم حفظه كـ "قيد المراجعة".
- يتم إرسال إشعار داخل الموقع + بريد إلكتروني يفيد بأن المنتج ينتظر المراجعة.
- لا يتم عرض المنتج في المتجر قبل الموافقة عليه من الإدارة.

### FR9 - إشعار الموافقة أو الرفض
- في حال الموافقة، يظهر المنتج تلقائيًا في صفحة المتجر.
- يتم إشعار البائع بذلك (إشعار داخلي + بريد إلكتروني).
- في حال الرفض، يتم إشعاره مع ذكر سبب الرفض إن وجد.

### FR10 - تعديل المنتج
- يمكن للبائع تعديل تفاصيل المنتج أو الخدمة في أي وقت، حتى بعد النشر.
- في حال تعديل جوهري (مثل السعر أو الصور)، يتم إعادة المنتج إلى حالة المراجعة مؤقتًا.
- لا يسمح بتعديل المنتج إذا كان هناك عليه عملية شراء أو طلب.

### FR11 - عرض المنتج
يتم عرض المنتج النهائي كما يلي:
- عنوان المنتج / الحرفة / الخدمة
- صورة / صور (حتى 5 صور)
- وصف مفصل
- التصنيف
- السعر
- الكلمات المفتاحية
- مدة التسليم المتوقعة
- الكمية المتاحة (إن وجدت)
- وقت التحضير (إذا كان المنتج حرفة أو خدمة)
- زر "أضف إلى المفضلة" (رمز قلب)
- إذا كان منتجًا قابلًا للبيع: يظهر زر "أضف إلى العربة" + "تواصل مع البائع"
- إذا كانت خدمة أو حرفة: يظهر زر "تواصل مع البائع"
- عرض تسمية واضحة لنوع المنتج (منتج قابل للبيع / حرفة / خدمة)

---

## 3. الطلبات والدفع

**وصف الخاصية:**
يسمح للمشتري بإنشاء طلبات شراء، تحديد الكمية والمتطلبات، والدفع الإلكتروني.

**خطوات الاستخدام:**
1. يضيف المستخدم المنتج إلى السلة.
2. يحدد الكمية والمتطلبات الخاصة.
3. ينشئ الطلب ويكمل عملية الدفع.
4. يتابع حالة الطلب حتى التسليم.

**متطلبات النظام:**
- دعم بوابات دفع إلكتروني آمنة.
- تتبع حالة الطلب (قيد الانتظار، مدفوع، جاري التنفيذ، جارى التوصيل ،مكتمل، ملغى).
- حالات الطلب عند المستخدم 
قيد الانتظار اول ما الطلب يتعمل و عتد موافقه البايع ,
مدفوع عند موافقه السوبر ادمن ,
جاري التنفيذ عند بدايه عمل البايع و لحد الضغط عند الانتهاء  
جارى التوصيل  من مرحله نسبلم الدليفرى و لحد التوصيل 
،مكتمل، عند تسليم المشترى 
ملغى عند الغاء الطلب من البايع او من عند السوبر ادمن 

- إشعارات عند تغيير حالة الطلب.

**سيناريوهات الحماية:**
- منع التلاعب في الأسعار أو الكميات.
- إلغاء الطلبات غير المدفوعة بعد فترة محددة.
- حماية بيانات الدفع.

### FR12 - إضافة منتج إلى العربة
- يستطيع المشتري الضغط على "أضف إلى العربة" في صفحة أي منتج.
- يتم حفظ المنتج مؤقتًا في "سلة المشتريات" المرتبطة بحساب المستخدم.

### FR13 - الدخول إلى سلة المشتريات
- يتمكن المستخدم من فتح "العربة" وعرض كل المنتجات التي أضافها.
- يظهر له: صورة المنتج، الاسم، السعر، الكمية، المجموع.

### FR14 - إتمام عملية الشراء
- عند الضغط على "إتمام الشراء"، يظهر نموذج معلومات الطلب:
    - الاسم
    - رقم الهاتف
    - العنوان بالتفصيل
    - علامة مميزة للمكان
    - اختيار وسيلة الدفع: (فودافون كاش – إنستا باي – عند الاستلام)

### FR15 - تسجيل الطلب
- يتم تسجيل الطلب في لوحة التحكم لكل من البائع والمشتري.
- يظهر الطلب بحالة افتراضية مثل: "قيد المعالجة" أو "بانتظار التأكيد".
- يظهر فى لوحه تحكم السوبر ادمن الطلب و بجب موافقه السوبر ادمن على الطلب و بياناته 
- عند دفع عربون يجب على المستحدم رفع صور اثبات الدفع من وسائل الدفع المختاره و تعرض للسوبر ادمن 
- مراحل مرور الطلب 
 * العميل بيملى بيانات الطلب و يدفع 
 * السوبر ادمن يوافق على الطلب بناء على صحه البيانات و صوره اثيات الدفع 
 * البايع بيوافق على الطلب و يضغط بدء العمل 
 * اول ما ينتهى من العمل يضغط انه انتهى و يحدد معاد استلام الدليفري منه  
 * الدليفرى بيحدد انه استلم المنتج 
 * الدليفرى بيجدد انه سلم الاوردر 
 * الاوردر بيكتمل و المشترى بيقدر يعمل تقيم للطلب داخل داش بورد الاوردر الخاص بيه و يقدر يقيم المنتج داخل صفحه المنتج بدام المنتج اكتمل 
### FR16 - التواصل مع البائع
- يظهر زر "تواصل مع البائع" في صفحة المنتج أو الحرفة.
- بناءً على الاختيار، يتم فتح محادثة بين المشتري والبائع مرتبطة بالمنتج أو الخدمة.

### FR17 - فتح طلب خاص من المحادثة
- بعد انتهاء التفاوض في الشات، يمكن للمشتري الضغط على زر:
    - "ادفع عربون" (في حالة الحرف أو الطلبات الخاصة)
    - "أضف المنتج إلى العربة" (في حالة المنتجات)

### FR18 - دفع عربون
- عند اختيار "دفع عربون"، يظهر Pop-up لإدخال المبلغ.
- يتم حساب النسبة المئوية من السعر الكلي تلقائيًا.
- يتم تسجيل قيمة العربون وتحويله للبائع داخل النظام.

### FR19 - إتمام طلب الحرفة بعد العربون
- بعد إرسال العربون، يتم فتح صفحة "معلومات الطلب" تمامًا مثل الشراء العادي.
- يُسجل الطلب مع رقم فريد، ويتم تحديث حالته للطرفين.

**متطلبات الأمان:**

### SR12 - التأكد من صلاحية الشراء
- لا يستطيع أي مستخدم غير مفعل تنفيذ عمليات شراء.
- لا يتم تنفيذ الطلب دون اكتمال معلومات الشحن والدفع.

### SR14 - حماية المحادثات
- تُربط كل محادثة بمنتج أو طلب معين، ولا يمكن الوصول لها من خارج السياق.
- يتم فلترة الكلمات المحظورة أو معلومات التواصل المباشرة.

### SR15 - تحقق من صحة العربون
- لا يمكن إرسال عربون أعلى من سعر المنتج الأصلي.
- يتم تخزين قيمة العربون وتاريخ الإرسال بدقة و اثبات الدفع عند طريق صوره  .

### SR16 - توثيق المعاملات
- كل خطوة من عمليات الشراء أو إرسال العربون يتم تسجيلها في Logs إدارية.
- يمكن للمشرفين مراجعة أي طلب مشبوه أو مشكل متعلق بالتحويل.

**سيناريوهات الحماية الإضافية:**

### UC9 - محاولة شراء بدون إدخال معلومات كافية
**الموقف:** مشتري يحاول تنفيذ الطلب بدون إدخال بيانات العنوان أو اختيار طريقة الدفع
**الحماية:**
- التحقق من كل الحقول قبل السماح بالشراء
- عرض رسائل توجيهية واضحة

### UC10 - التلاعب بقيمة العربون
**الموقف:** مشتري يُدخل قيمة عربون أكبر أو غير منطقية
**الحماية:**
- التحقق من أن قيمة العربون لا تتجاوز 100% من السعر الأساسي
- التحقق من أن المنتج يدعم العربون أصلًا (مثل الحرف فقط)

### UC12 - محاولة الوصول لطلب غير مملوك
**الموقف:** مستخدم يغير ID الطلب للوصول لطلب ليس له
**الحماية:**
- تحقق صارم من ملكية الطلب قبل عرضه أو تنفيذه

---

## 4. الدردشة والدعم

**وصف الخاصية:**
نظام محادثة فورية بين المشتري والبائع لمناقشة تفاصيل المنتجات والطلبات.

**خطوات الاستخدام:**
1. يضغط المستخدم على "محادثة" في صفحة المنتج أو الطلب.
2. يرسل الرسائل ويستقبل الردود من الطرف الآخر.
3. يمكن إرسال تفاصيل الطلب أو الاتفاقات عبر الشات.

**سيناريوهات الحماية الإضافية:**
### UC11 - محاولة تواصل خارج النظام
**الموقف:** أحد المستخدمين يحاول إرسال معلومات تواصل خارجي عبر الشات
**الحماية:**
- نظام فلترة تلقائي للكلمات (رقم هاتف – بريد – واتساب – روابط...)

**متطلبات النظام:**
- تخزين الرسائل بشكل آمن.
- دعم الإشعارات الفورية.
- ربط المحادثة بالمنتج أو الطلب.

**سيناريوهات الحماية:**
- منع إرسال روابط أو محتوى ضار.
- إمكانية الإبلاغ عن إساءة الاستخدام.
- حفظ سجل المحادثات للرجوع إليه عند الحاجة.

### FR20 - رسالة ترحيب بالبائع بعد التسجيل
- عند تسجيل الدخول لأول مرة كبائع، تظهر رسالة ترحيب + Pop-up:
- "مبروك ليك 30 يوم مجانا علشان سجلت معانا ولو عايز تاخد 30 تاني مجانا اضغط هنا".

### FR21 - نظام دعوة الأصدقاء (Referral)
- يتم إنشاء رابط دعوة فريد لكل حساب.
- عند دخول 10 أشخاص مختلفين من أجهزة (IP) مختلفة عبر الرابط:
  - يمكن للبائع تمديد الباقة المجانية لمدة شهر إضافي.
- يمكن تكرار هذا التمديد مرتين فقط (أي: أقصى مدة للباقة المجانية = 3 شهور خلال أول 3 شهور من إنشاء الحساب).
- بعد التسجيل يحصل المستخدم تلقائيًا على شهر مجاني كبائع.
- بعد انتهاء الحد الأقصى للتمديدات، لا يمكن الاستفادة من الدعوات لتمديد الباقة المجانية.

### FR22 - نظام الباقات
**🟢 الباقة 1 (مجانية):**
- يحصل عليها المستخدم بمجرد التسجيل كبائع لمدة شهر واحد فقط.
- يمكن تمديدها شهر إضافي عند دعوة 10 أشخاص مختلفين (IP فريد) عبر رابط الدعوة.
- يمكن تكرار التمديد مرتين فقط (بحد أقصى 3 شهور مجانية خلال أول 3 شهور من إنشاء الحساب).
- بعد انتهاء الحد الأقصى للتمديدات، يجب الاشتراك في باقة مدفوعة لرفع المنتجات أو الاستمرار في الميزات.

**🟡 الباقة 2 (أساسية - 100 جنيه):**
تتيح:
- رفع المنتجات.
- عدم وجود عمولة.
- توصيل المنتجات من خلال المنصة.

**🔴 الباقة 3 (احترافية - 250 جنيه):**
تتيح كل ميزات الباقة الثانية بالإضافة إلى:
- تصوير احترافي للمنتجات (بالتنسيق مع إدارة الموقع).
- إمكانية إنشاء حدث/بازار.
- الإعلان عن الحدث داخل الموقع.

### FR23 - نظام إشعارات الباقات
**قبل 5 أيام من انتهاء أي باقة:**
- يُرسل إشعار داخل الموقع.
- يُرسل بريد إلكتروني مسجل لدى البائع.

**عند انتهاء الباقة:**
- يظهر Pop-up: "الباقة انتهت، من فضلك قم بالتجديد".
- يتم تعطيل لوحة التحكم.
- يتم تجميد المنتجات (لا تظهر في البحث).
- يتم إخفاء إمكانية التعديل أو الإضافة.
- **استثناء:** الطلبات النشطة تبقى متاحة للبائع لإكمالها أو متابعتها حتى بعد انتهاء الباقة، لكن لا يمكن إضافة أو تعديل منتجات جديدة حتى التجديد.

### FR24 - التجديد والاشتراك في الباقات
**عند الاشتراك في أي باقة:**
- يظهر Pop-up: "مبروك لقد اشتركت في [اسم الباقة] وصلاحيتها [30 يوم]".
- يتم ربط الباقة بالحساب باسم ورقم الاشتراك وتاريخ التفعيل.

**في الملف الشخصي:**
يظهر بجانب الصورة دائرة مميزة باللون حسب نوع الباقة:
- 🟢 أخضر = الباقة المجانية
- 🟡 أصفر = الباقة 100
- 🔴 أحمر = الباقة 250
- هذه العلامة مرئية لصاحب الحساب فقط.

---

## 5. التقييمات والمراجعات

**وصف الخاصية:**
يستطيع المشتري تقييم المنتج وكتابة مراجعة بعد استلام الطلب.

**خطوات الاستخدام:**
1. بعد اكتمال الطلب، يظهر للمستخدم خيار "إضافة تقييم".
2. يحدد التقييم ويكتب المراجعة.
3. تظهر التقييمات في صفحة المنتج.

**متطلبات النظام:**
- ربط كل تقييم بطلب مكتمل.
- مراجعة التقييمات قبل النشر (اختياري).
- حساب متوسط التقييمات للمنتج.

**سيناريوهات الحماية:**
- منع التقييمات المزيفة أو المسيئة.
- السماح بحذف أو إخفاء التقييمات المخالفة.
- منع المستخدم من تقييم نفس المنتج أكثر من مرة لكل طلب.

---

## 6. لوحة تحكم الإدارة

**وصف الخاصية:**
واجهة خاصة للمشرف لإدارة المستخدمين، البائعين، المنتجات، الطلبات، والشكاوى.

**خطوات الاستخدام:**
1. يسجل المشرف الدخول إلى لوحة الإدارة.
2. يمكنه استعراض وإدارة جميع البيانات (تفعيل/تعليق/حذف).
3. مراجعة الشكاوى والتقارير واتخاذ الإجراءات اللازمة.

**متطلبات النظام:**
- صلاحيات خاصة للمشرفين فقط.
- سجل نشاطات لكل عملية إدارية.
- واجهة سهلة لاستعراض البيانات.

**سيناريوهات الحماية:**
- منع الوصول للوحة الإدارة لغير المخولين.
- توثيق جميع العمليات الإدارية.
- حماية من التلاعب أو حذف البيانات الهامة.

---

## 7. دفع العربون عبر الشات

**وصف الخاصية:**
إمكانية دفع عربون من خلال شات خاص بين المشتري والبائع عند الاتفاق على تفاصيل الطلب، ثم إكمال الدفع لاحقًا.

**خطوات الاستخدام:**
1. يفتح المستخدم محادثة خاصة مع البائع حول منتج معين.
2. بعد الاتفاق، يظهر زر "دفع عربون" في الشات.
3. عند الدفع، يتم تسجيل العربون وربطه بالطلب.
4. بعد تنفيذ الطلب، يمكن للمستخدم دفع باقي المبلغ من نفس الطلب.

**متطلبات النظام:**
- دعم دفعات جزئية (عربون + باقي المبلغ).
- تحديث حالة الطلب تلقائيًا حسب الدفعات.
- إشعارات عند كل دفعة.
- توثيق جميع العمليات في سجل الطلب.
- **تتبع الرصيد المتبقي:** يجب أن يسجل النظام قيمة العربون المدفوع وقيمة الرصيد المتبقي لكل طلب.
- **دفع الرصيد المتبقي:** بعد دفع العربون، يمكن للمستخدم دفع الرصيد المتبقي من خلال نفس الطلب في أي وقت حتى اكتمال الطلب.
- **تحديث حالة الطلب:** عند دفع الرصيد المتبقي بالكامل، يتم تحديث حالة الطلب إلى "مدفوع بالكامل" أو "جاهز للتنفيذ" حسب سير العمل.
- **التحقق من صحة الدفع:** لا يمكن دفع أكثر من الرصيد المتبقي، ويجب التحقق من صحة المبلغ المدفوع في كل عملية دفع.
- **واجهة المستخدم:** يجب أن تعرض واجهة الطلب للمشتري والبائع تفاصيل: قيمة العربون، الرصيد المتبقي، وإمكانية دفع الرصيد المتبقي إذا لم يكن مدفوعًا بالكامل.
- **سجل الدفعات:** يجب الاحتفاظ بسجل جميع الدفعات (العربون والدفعات اللاحقة) مع التاريخ والمبلغ لكل دفعة.

**سيناريوهات الحماية:**
- لا يمكن إلغاء الطلب بعد دفع العربون إلا بموافقة البائع.
- في حال عدم إكمال الدفع خلال فترة محددة، يمكن للبائع إلغاء الطلب مع سياسة استرداد واضحة.
- دفع العربون يتم فقط من خلال شات خاص مرتبط بالمنتج والطلب، وليس في أي شات عام أو جماعي.

---

## 8. إدارة المفضلات

**وصف الخاصية:**
تمكن المستخدم من حفظ المنتجات المفضلة لديه لسهولة الوصول إليها لاحقًا.

**خطوات الاستخدام:**
1. أثناء تصفح المنتجات، يمكن للمستخدم الضغط على أيقونة "إضافة إلى المفضلة" بجانب المنتج.
2. يتم إضافة المنتج إلى قائمة المفضلات الخاصة بالمستخدم.
3. يمكنه الوصول إلى قائمة المفضلات من خلال صفحته الشخصية.

**متطلبات النظام:**
- ربط كل مستخدم بقائمة مفضلاته.
- دعم عرض المفضلات في صفحة مستقلة.
- إمكانية إزالة أي منتج من قائمة المفضلات.

**سيناريوهات الحماية:**
- منع إضافة منتجات غير موجودة أو محذوفة.
- تأمين قائمة المفضلات بكلمة مرور أو توثيق ثنائي إذا لزم الأمر.
- حماية بيانات المستخدمين والمفضلات من الوصول غير المصرح به.

---


# وثيقة متطلبات نظام منصة "بازار" (SRS)

## ١. التسجيل وتسجيل الدخول
### المتطلبات الوظيفية
- ✅ تسجيل مستخدمين (بائعين/مشترين)
- ✅ التحقق عبر البريد الإلكتروني (رمز 6 أرقام)
- ✅ تسجيل دخول بالبريد الإلكتروني + كلمة المرور
- ✅ صلاحيات لوحة التحكم حسب الدور

### متطلبات الأمان
- 🔒 تأكيد البريد الإلكتروني إلزامي
- 🔒 تشفير قوي لكلمات المرور
- 🔒 قفل الحساب بعد 5 محاولات فاشلة

### سيناريوهات الحماية
- ⚠️ تعليق الحساب عند استخدام بريد مزيف
- ⚠️ تسجيل محاولات الدخول الفاشلة
- ⚠️ تغيير كلمة المرور يتطلب تحققًا

---

## ٢. الطلبات والشراء
### المتطلبات الوظيفية
- 🛒 متطلبات إنشاء الطلب:
  - إثبات الدفع (للطرق اليدوية)
  - إكمال البيانات المطلوبة
- 🔄 مسار حالة الطلب:
  1. قيد المراجعة → 2. قيد التجهيز → 3. قيد الشحن → 4. تم التسليم → 5. ملغي
- ✏️ الإلغاء/التعديل قبل مرحلة "قيد الشحن"

### متطلبات الأمان
- 🔐 تسجيل الدخول مطلوب
- 🔐 التحقق من إثبات الدفع
- 🔐 سجل تدقيق للمعاملات

### سيناريوهات الحماية
- 🛡️ حظر المستخدم عند إثبات دفع مزيف
- 🛡️ إشعارات للطلبات المرفوضة
- 🛡️ تحديث حالة الطلب فورًا

---

## ٣. الشراء عبر الدردشة
### المتطلبات الوظيفية
- 💬 زر "تواصل مع البائع" في صفحات المنتجات
- 🤝 تفاوض داخل الدردشة (المنتج/السعر/الدفعة)
- 🛍️ زر "إنشاء طلب" داخل الدردشة
- 📋 نموذج الطلب يحتوي على:
  - تفاصيل المنتج
  - السعر المتفق عليه
  - قيمة الدفعة المقدمة

### متطلبات الأمان
- 🔒 ربط الطلبات بسجل المحادثة
- 🔒 التحقق من البيانات + الدفع

### سيناريوهات الحماية
- ⚔️ حظر المحاولات للتواصل خارج المنصة
- ⚔️ كشف احتيال السعر/الدفعة
- ⚔️ توثيق كامل للعملية

---

## ٤. نظام التوصيل
### المتطلبات الوظيفية
- 🗺️ تتبع GPS في الوقت الفعلي
- 📸 إرفاق صور عند رفض المنتج
- 🏠 عناوين واضحة للاستلام/التسليم
- 🔄 محاولتي إعادة توصيل خلال 3 أيام
- ⭐ تقييم موظف التوصيل بعد التسليم

### متطلبات الأمان
- 🪪 التحقق من هوية الموظف + سجل النشاط
- 🔑 تسجيل الدخول لبدء التوصيل

### سيناريوهات الحماية
- 🔍 مراجعة المشرف قبل النشر
- 🚫 إلغاء الفعاليات غير الملتزمة
- ⏸️ تعليق المنظمين المخالفين

---

## ٥. نظام المراسلة
### المتطلبات الوظيفية
- ✉️ تواصل المشتري-البائع
- 🖼️ مراسلة مع دعم الصور
- 🛒 إنشاء طلب من داخل الرسائل

### متطلبات الأمان
- 🔏 تسجيل الدخول مطلوب
- 👁️ مراقبة محتوى تلقائية
- 🖼️ فحص الصور قبل التسليم

### سيناريوهات الحماية
- 🚫 حذف المحتوى المحظور + حظر
- 🔗 منع مشاركة جهات اتصال/روابط
- ⏸️ تعليق الحساب للمخالفين

---

## ٦. التقييمات والمراجعات
### المتطلبات الوظيفية
- ⭐ تقييم بنجوم (1-5)
- 📝 مراجعات نصية + ردود البائعين
- 📊 عرض متوسط التقييم في الملفات
- 🔍 ترتيب البائعين حسب التقييم

### متطلبات الأمان
- ✅ اكتمال الطلب مطلوب للمراجعة
- 🔍 مراجعة المحتوى قبل النشر
- ✏️ التعديل يتطلب تذكرة دعم

### سيناريوهات الحماية
- ❌ حظر التقييمات الزائفة
- 🧾 إخفاء المراجعات غير العادلة
- 🔗 ربط المراجعة بالطلب

---

## ٧. المجتمع (بلوز Blooz)
### المتطلبات الوظيفية
- 📢 منشورات المستخدمين (أسئلة/تجارب)
- ❤️ تفاعلات إعجاب/تعليق
- 🏷️ وسم المستخدمين الموثوقين
- 🗂️ تصنيف المنشورات

### متطلبات الأمان
- 🔐 تسجيل الدخول للمشاركة
- 🤖 كشف تلقائي للمحتوى المسيء

### سيناريوهات الحماية
- 🧹 إزالة المحتوى المخالف
- ⏸️ حظر مؤقت/دائم
- 📌 إخفاء المحتوى الترويجي

---

## ٨. الفعاليات (البازارات)
### المتطلبات الوظيفية
- 📅 تقويم فعاليات عام
- 💎 المميزون (250 جنيه/شهر) يمكنهم إنشاء فعاليات
- 📍 تفاصيل الفعالية: موقع/وقت/أنشطة
- 📝 تسجيل الزوار/العارضين

### متطلبات الأمان
- 🪪 التحقق من الهوية + نوع الاشتراك
- 🙈 إخفاء معلومات التواصل حتى الموافقة

### سيناريوهات الحماية
- 🔍 مراجعة المشرف قبل النشر
- 🚫 إلغاء الفعاليات غير الملتزمة
- ⏸️ تعليق المنظمين المخالفين

---

## ٩. نظام الشكاوى
### المتطلبات الوظيفية
- 📋 نماذج شكاوى مخصصة
- 📎 دعم المرفقات (صور/وثائق)
- ⏱️ الرد خلال 48 ساعة (SLA)

### متطلبات الأمان
- 🔐 تسجيل الدخول مطلوب
- 🗄️ أرشفة الشكاوى في لوحة المستخدم

### سيناريوهات الحماية
- ⚖️ معاقبة المستخدمين عند ثبوت الشكاوى
- 🚫 حظر الشكاوى الكيدية
- 📊 تتبع الأداء عبر مؤشرات الشكاوى

## ٨. الدليفرى
عاوزين نعمل موديل الدليفرى 
افحص الكود الحالى للباك و الفرونت و تكامل معه بحيث يحقق الأتى 
نعمل داش بورد للدليفؤى يقدر من خلالها الدليفرى تسجيل الدخول من خلال ايمل و باسورد عمله له الادمن العام و يرسل علي ايميله و لايستطيع انشاء حساب لكن الأدمن يستطيع عمل حساب ة ارسال بيانات الحساب للايميل المسجل 

عند الدخول لحساب الدليفرى 
بجد تلات صفحات 
- صفحه الترحيب و بها احصائيات من عدد الاوردرات المستلمه من البائعين و عدد الأوردرات المسلمه للمستخدمين و زرار يظهر فيه للادمن اذا كان متاح للعمل ام لا بحيث عند النقر عليه يظهر انه متاح 
- صفحه الاوردرات الواجب استلامها من الباعين و يظهر فيها الطلبات عنوان الطلب و تفاصيل موجزه للطلب اسم البائع و المشترى و ارقامهم و يظهر الطلبات بشكل جميل فى كاردات و عند الوصول للبائع يضغط انه استلم الاوردر لتتحدث حاله الطلب للبائع و المشترى "يجب مراعاه حالات الاستلام الطلب الموجوده فى السيستم" و الطلبات تظهر للدليفرى فى الايام المكتوبه فى التسليم 
- صفحه الطلبات الواجب تسليمها للمشترين و بها نفس تفاصيل الصفحه السابقه 

الداش بورد ممكن الدليفرى الدخول لها من خلال mydomain/delivery
بحيث بعد تسجبل الدخول يقدر يشوف الصفحات الخاصه بيه 

يتم تغيير حالة الطلب من خلال الدليفرى فقط، بحيث عند استلام المنتج من البائع يضغط الدليفرى على زر لتحديث حالة الطلب إلى "تم الاستلام من البائع"، وعند تسليم المنتج للعميل يضغط على زر آخر لتحديث حالة الطلب إلى "تم التسليم للعميل"، بدون الحاجة لإدخال أكواد من البائع أو العميل.

الطلبات تظهر للدليفرى فى الايام المكتوبه فى التسليم 

الادمن يقدر يضع الاوردرات للدليفرى و الدليفرى مالهوش دور انه يختار الاوردرات 
و كل اوردر الدليفرى بيسلمه للمشترى او بستلمه من البايع بياخد عليه 10 ج 
يقدر الادمن يختار اكتر من اوردر لنفس الدليفرى عن طريق انه من لوحه تحكم الادمن بيبقى عنده صفحه للطلبات اللى هيستلمها من البايع  او يسلمها للمشترى و الادمن يخنار الطلبات و يبعتها للدليفرى من قائمه بها اسماء الدليفرى المتاح للعمل 

اعمل السناريو ده للباك و الفرونت و حول اى نموذج خاص بالدلفرى موجود حاليا بالسيستم ليتكامل مع السيناريو ده 

## ٨. الأرباح
عاوزين نعمل صفحه الارباح dashboard/earnings
تبقى دينامك تحسب الارباح عند اكتمال الطلب و بعد ما الطلب يوصل انه مكتمل يتحول فلوس البائع لمحفظته و كل اوردر يعمله و يكنمل يتحول الفلوس لمحفظته و يقدر البائع يسحب فلوس الطلبات المكتمله عن طريق انه يبعت طلب للامن بانه عاوز يسحب مبلغ من المجفظه او كامل المبلع من المحفظه بحد ادنى 100 ج و اقصى 100 الف ج او حسب ما بحدد الادمن من لوحه تحكم الادمن و بعد طلب سحب المال من المحفظه يصل الطلب للوحه تحكم الادمن و اللى من خلالها بقدر الادمن يوافق على سحب المال و يقوم بتحويله يدوى عن طريق ارساله باى طريقه اون لاين سواء فودافون كاش او انستاى باى او عير على الرقم اللى البايع هيكتبه لما يطلب سحب الاموال من المحفظه و اذا رفص الادمن سحب المال يكتب السبب اللى هيظهر للبايع فى جدول بيعرض كل عمليات السحب و حالتها و مبلغ السحب فى صفحه الارباح 
كما ايضا نجعل صفحه الارباح دينامك كالتالى 
إجمالي الإيرادات: كل ايرادات الاوردرات المكتمله سواء مسحوبه ام لا 
قيد التحصيل: اوردرات لم تكتمل 
تم سحبها :تم سحبها بنجاح
متاح للسحب :اوردرات مكتمله جاهزه للسحب 

ملخص الأرباح الشهري
اجعلها دينماك ايضا من الاوردات المياعه 

إدارة المدن (Admin Panel)
إضافة قسم جديد في لوحة تحكم الأدمن باسم المدن.
إمكانية إضافة/تعديل/حذف مدينة.
عند إضافة مدينة، تظهر خانتين:
سعر التوصيل (Delivery Fee) – قيمة ثابتة تُضاف على الطلب.
نسبة ربح المنصة (Platform Commission %) – نسبة مئوية من قيمة الطلب تخصم من البائع.
عملية إنشاء الطلب (User Order)
عند إنشاء طلب، المستخدم يختار المدينة.
عند اختيار المدينة:
سعر التوصيل يظهر ويُضاف على إجمالي الفاتورة.
نسبة ربح المنصة لا تظهر للمشتري، لكنها تحفظ في الطلب وتظهر للبائع فقط في تفاصيل الطلب.
هذه الإضافة تطبق على كل أنواع الطلبات:
خدمة خاصة.
منتج.
تفاصيل الطلب (Order Details)
المشتري يشوف: السعر الأساسي + سعر التوصيل.
البائع يشوف: السعر الأساسي + سعر التوصيل + نسبة ربح المنصة المخصومة + صافي المبلغ المستحق
الأدمن يشوف كل التفاصيل.
حساب الأرباح (Profit Calculation)
بمجرد أن يتم تغيير حالة الطلب إلى مكتمل:
يتم حساب وتسجيل نسبة ربح المنصة في جدول أرباح المنصة مباشرة.
يتم حفظ هذه البيانات في خانة جديدة في لوحة التحكم باسم أرباح المنصة.
لوحة تحكم الأدمن (Admin Dashboard)
قسم أرباح المنصة يعرض:
إجمالي الأرباح.
تفاصيل الأرباح لكل طلب مكتمل (مع رقم الطلب، المدينة، وقيمة النسبة).
مصاريف التوصيل تظهر لكل الأطراف في الطلبات.
Notes:
نسبة الربح تُحسب على السعر قبل إضافة التوصيل.
سعر التوصيل يُضاف دائماً على إجمالي الفاتورة للمشتري ويظهر في كل التفاصيل.
النظام يدعم الطلبات بأنواعها (منتجات / خدمات).